<UserControl x:Class="KanaTrainer.Views.TrainingSettingsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             
             xmlns:local="clr-namespace:KanaTrainer.Views"
             xmlns:kvms="clr-namespace:KanaTrainer.ViewModels.KanaViewModels"
             
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800">

    <UserControl.Resources>

        <DataTemplate
            x:Key="KanaTemplate"
            DataType="{x:Type kvms:KanaViewModel}">
            <ToggleButton
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                
                Margin="2.5"
                Padding="8"
                IsChecked="{Binding IsSelected}">
                <ToggleButton.Content>
                    <StackPanel>
                        <TextBlock 
                            FontSize="24"
                            Text="{Binding Character}" />
                        <TextBlock
                            FontSize="12"
                            Text="{Binding Romaji}" />
                    </StackPanel>
                </ToggleButton.Content>

                <ToggleButton.Style>
                    <Style TargetType="{x:Type ToggleButton}">
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="ToggleButton">

                                    <Border
                                        Padding="{TemplateBinding Padding}"
                                        BorderBrush="{TemplateBinding BorderBrush}"
                                        Background="{TemplateBinding Background}">
                                        <ContentPresenter HorizontalAlignment="Center"
                                                          VerticalAlignment="Center"/>
                                    </Border>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>

                        <Style.Triggers>
                            <Trigger Property="IsChecked" Value="True">
                                <Setter Property="Background" Value="{StaticResource SelectedColor}"/>
                                <Setter Property="Foreground" Value="White" />
                            </Trigger>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Cursor" Value="Hand" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </ToggleButton.Style>
                
            </ToggleButton>
            
        </DataTemplate>

        <DataTemplate
            x:Key="KanaGroupTemplate"
            DataType="{x:Type kvms:KanaGroupViewModel}">

            <HeaderedItemsControl
                ItemsSource="{Binding Group}"
                ItemTemplate="{StaticResource KanaTemplate}"
                Margin="5 0 0 0">

                <HeaderedItemsControl.Header>
                    <ToggleButton
                        Content="{Binding Name}"
                        IsChecked="{Binding IsSelected}"
                        Style="{StaticResource SelectableHeaderStyle}"/>
                </HeaderedItemsControl.Header>

                <HeaderedItemsControl.Template>
                    <ControlTemplate TargetType="{x:Type HeaderedItemsControl}">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="auto" />
                                <RowDefinition />
                            </Grid.RowDefinitions>

                            <ContentPresenter
                                Grid.Row="0" 
                                ContentSource="Header" />
                            <ItemsPresenter
                                Grid.Row="1"/>
                        </Grid>
                    </ControlTemplate>
                </HeaderedItemsControl.Template>

                <HeaderedItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel/>
                    </ItemsPanelTemplate>
                </HeaderedItemsControl.ItemsPanel>

            </HeaderedItemsControl>
        </DataTemplate>

        <DataTemplate
            x:Key="KanaSystemTemplate"
            DataType="{x:Type kvms:KanaSystemViewModel}">

            <HeaderedItemsControl
                ItemsSource="{Binding System}"
                ItemTemplate="{StaticResource KanaGroupTemplate}">

                <HeaderedItemsControl.Header>
                    <ToggleButton
                        Content="{Binding Name}"
                        IsChecked="{Binding IsSelected}"
                        Style="{StaticResource SelectableHeaderStyle}"/>
                </HeaderedItemsControl.Header>

                <HeaderedItemsControl.Template>
                    <ControlTemplate TargetType="{x:Type HeaderedItemsControl}">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition />
                            </Grid.ColumnDefinitions>

                            <ContentPresenter
                                Grid.Column="0"
                                ContentSource="Header" >
                                <ContentPresenter.LayoutTransform>
                                    <RotateTransform Angle="270" />
                                </ContentPresenter.LayoutTransform>
                            </ContentPresenter>

                            <ItemsPresenter
                                Margin="10 0 0 0"
                                Grid.Column="1" />
                        </Grid>
                    </ControlTemplate>
                </HeaderedItemsControl.Template>
                
                <HeaderedItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel
                            Orientation="Horizontal"
                            FlowDirection="LeftToRight"/>
                    </ItemsPanelTemplate>
                </HeaderedItemsControl.ItemsPanel>
            </HeaderedItemsControl>
            
        </DataTemplate>

        <DataTemplate x:Key="KanaSystemDisplayTemplate" DataType="{x:Type kvms:KanaSystemViewModel}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto"/>
                    <RowDefinition Height="auto"/>
                </Grid.RowDefinitions>

                <TextBlock
            Grid.Row="0"
            HorizontalAlignment="Stretch"
        
            Text="{Binding Path=System[0].Group[0].Character}"
            TextAlignment="Center"
            FontSize="18"/>

                <TextBlock
            Grid.Row="1"
            HorizontalAlignment="Stretch"
        
            Text="{Binding Path=Name}"
            TextAlignment="Center"
            FontSize="12"/>
            </Grid>
        </DataTemplate>

    </UserControl.Resources>

    <ScrollViewer
        VerticalScrollBarVisibility="Hidden"
        HorizontalScrollBarVisibility="Disabled">
        <Grid
            IsSharedSizeScope="True">
            <Grid.RowDefinitions>
                <RowDefinition Height="auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <TextBlock
                Grid.Row="0"
                Margin="20 40 0 0"
                FontSize="32"
                Text="Training Settings"
                FontWeight="SemiBold"
                HorizontalAlignment="Center"/>

            <Grid
                Grid.Row="1"
                Margin="20 20"
                HorizontalAlignment="Center">

                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="auto" />
                </Grid.RowDefinitions>


                <Grid
                    Grid.Row="0">

                    <Grid.ColumnDefinitions>
                        <ColumnDefinition SharedSizeGroup="SettingsColumn" Width="auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto"/>
                        <RowDefinition Height="auto"/>
                        <RowDefinition Height="auto"/>
                    </Grid.RowDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Style="{StaticResource SettingsMenuHeaderStyle}"
                        Text="General"/>

                    <Separator
                        Grid.Row="1"
                        Style="{StaticResource SettingsMenuHeaderSeparatorStyle}"/>

                    <Grid
                        Grid.Row="2"
                        Margin="0 10 0 0">

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TextBlock
                            Grid.Column="0"
            
                            Text="Training Type"
                            FontSize="14"/>

                        <Separator
                            Margin="10 0 0 0"
                            Grid.Column="1"
                            VerticalAlignment="Stretch"
                            Width="1"
                            Style="{StaticResource VerticalSeparatorStyle}"/>

                        <ComboBox
                            Grid.Column="2"
                            Grid.Row="0"
                            
                            Style="{StaticResource SettingsComboBoxStyle}"

                            Margin="10 0 0 0"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Stretch"
                            ItemsSource="{Binding AvailableTrainingTypes}"
                            SelectedValue="{Binding CurrentTrainingType}">
                        </ComboBox>
                    </Grid>
                </Grid>

                <Grid
                    Grid.Row="1"
                    Margin="0 10 0 0">
                
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition SharedSizeGroup="SettingsColumn" Width="auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="auto" />
                    </Grid.RowDefinitions>

                    <TextBlock
                        Grid.Row="0"
                        Style="{StaticResource SettingsMenuHeaderStyle}"
                        Text="Writing System"/>

                    <Separator
                        Grid.Row="1"
                        Style="{StaticResource SettingsMenuHeaderSeparatorStyle}"/>

                    <ListBox
                        Grid.Row="2"
                        
                        BorderThickness="0"
                        
                        ItemTemplate="{StaticResource KanaSystemDisplayTemplate}"
                        ItemContainerStyle="{StaticResource KanaSystemDisplayContainerStyle}"
                        
                        ItemsSource="{Binding AvailableKanaSystems}"
                        SelectedItem="{Binding SelectedKanaSystem}">

                        <ListBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ListBox.ItemsPanel>
                    </ListBox>

                    <Border Grid.Row="3"
                            Margin="0 10 0 0"
                            BorderThickness="2"
                            CornerRadius="5"
        
                            HorizontalAlignment="Left"
                            Padding="20"
        

                            DataContext="{Binding CurrentKanaSystem}">

                        <Border.Style>
                            <Style TargetType="{x:Type Border}">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Path=IsSelected}" Value="True" >
                                        <Setter Property="BorderBrush" Value="{StaticResource SelectedColor}" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Path=IsSelected}" Value="False" >
                                        <Setter Property="BorderBrush" Value="{StaticResource DeselectedColor}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <Grid>

                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                                <ColumnDefinition Width="auto" />
                            </Grid.ColumnDefinitions>

                            <ContentPresenter
                                Grid.Column="0"
                                ContentTemplate="{StaticResource KanaSystemTemplate}"
                                Content="{Binding}"/>

                            <ContentPresenter
                                Margin="20 0 0 0"
                                Grid.Column="1"
                                ContentTemplate="{StaticResource KanaSystemTemplate}"
                                Content="{Binding DakutenSystem}"/>

                            <ContentPresenter
                                Margin="20 0 0 0"
                                Grid.Column="2"
                                ContentTemplate="{StaticResource KanaSystemTemplate}"
                                Content="{Binding HandakutenSystem}"/>
                        </Grid>
                    </Border>
                </Grid>

                <Button Grid.Row="2"
                        Margin="0 20 0 0"
                        HorizontalAlignment="Center"
                        Content="Go Back"
                        Style="{StaticResource MenuNavigationButton}"
                        Command="{Binding NavigateKanaTrainingCommand}">
                </Button>
            </Grid>
        </Grid>
    </ScrollViewer>
</UserControl>
